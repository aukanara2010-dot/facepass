# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–∞—É—Ç–æ–≤ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ - –ó–∞–≤–µ—Ä—à–µ–Ω–æ ‚úÖ

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–µ—Ä–≤–∏—á–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏ –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–µ—Å—Å–∏–π), —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–∞–π–º–∞—É—Ç–∞–º –∏ –ø–ª–æ—Ö–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º—É –æ–ø—ã—Ç—É.

## –†–µ—à–µ–Ω–∏–µ

### 1. ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –≤ FastAPI

**Middleware –¥–ª—è —Ç–∞–π–º–∞—É—Ç–æ–≤ (`app/main.py`):**
```python
@app.middleware("http")
async def timeout_middleware(request, call_next):
    extended_timeout_endpoints = {
        "/api/v1/faces/search-session": 600,  # 10 –º–∏–Ω—É—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å –∞–≤—Ç–æ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π
        "/api/v1/faces/index-session": 900,   # 15 –º–∏–Ω—É—Ç –¥–ª—è —Ä—É—á–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
    }
    
    timeout = extended_timeout_endpoints.get(request.url.path, 30)  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 30 —Å–µ–∫
```

### 2. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

**–ù–æ–≤—ã–µ –ø–æ–ª—è –≤ –æ—Ç–≤–µ—Ç–µ API:**
```json
{
  "matches": [...],
  "indexing_status": "completed|indexing|already_indexed|no_photos|error",
  "indexing_progress": {
    "status": "completed",
    "total_photos": 150,
    "successful_photos": 148,
    "failed_photos": 2,
    "indexing_time_seconds": 45.2,
    "photos_per_second": 3.3,
    "sample_errors": [...]
  }
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:**
- `not_needed` - —Å–µ—Å—Å–∏—è —É–∂–µ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∞
- `already_indexed` - –Ω–∞–π–¥–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
- `indexing` - –ø—Ä–æ—Ü–µ—Å—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤ —Ä–∞–±–æ—Ç–µ
- `completed` - –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
- `no_photos` - –≤ —Å–µ—Å—Å–∏–∏ –Ω–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- `scan_error` - –æ—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è S3
- `indexing_failed` - –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å
- `indexing_error` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

### 3. ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

**–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:**
- –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –ø–µ—Ä–µ–¥ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö/—É—Å–ø–µ—à–Ω—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –°–±–æ—Ä –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –æ—à–∏–±–æ–∫

### 4. ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–õ–∏–º–∏—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
- –ú–∞–∫—Å–∏–º—É–º 300 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (10 –º–∏–Ω—É—Ç –ø—Ä–∏ 2 —Å–µ–∫/—Ñ–æ—Ç–æ)
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ —Å–µ—Å—Å–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –±–æ–ª—å—à–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- Graceful handling –±–æ–ª—å—à–∏—Ö —Å–µ—Å—Å–∏–π

### 5. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π JavaScript (`app/static/js/face-search.js`):**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ
- –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ (408 —Å—Ç–∞—Ç—É—Å)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π HTML (`app/static/session/index.html`):**
- –î–æ–±–∞–≤–ª–µ–Ω –∫–ª–∞—Å—Å `status-message` –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ —Ç–æ—á–µ–∫ –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 6. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–¢–∞–π–º–∞—É—Ç—ã:**
- 408 —Å—Ç–∞—Ç—É—Å —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–û—à–∏–±–∫–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:**
- –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –≤ –æ—Ç–≤–µ—Ç–µ
- Fallback –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –ø–æ–∏—Å–∫ (–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –Ω—É–∂–Ω–∞)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–µ–ª—Ñ–∏
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è: "–ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º 150 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç."
3. –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∑–∞ 2-3 –º–∏–Ω—É—Ç—ã
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è: "–ü—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–æ 148 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∑–∞ 45—Å"
5. –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–µ–ª—Ñ–∏
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è: "–ò—â–µ–º –≤–∞—à–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏..."
3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –¢–∞–π–º–∞—É—Ç
1. –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ 10 –º–∏–Ω—É—Ç
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è: "–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–Ω—è–ª–∞ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
`test_indexing_timeouts.py` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å –∞–≤—Ç–æ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π
- –†—É—á–Ω—É—é –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º–∏ —Ç–∞–π–º–∞—É—Ç–∞–º–∏
- –û–±—Ä–∞–±–æ—Ç–∫—É —Å—Ç–∞—Ç—É—Å–æ–≤ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

### –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
python test_indexing_timeouts.py
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–û–∂–∏–¥–∞–µ–º—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:**
- ~2-3 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é (–≤–∫–ª—é—á–∞—è S3, InsightFace, –ë–î)
- 300 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∑–∞ ~10 –º–∏–Ω—É—Ç
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–µ—Å—Å–∏–π

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- –ü–æ–¥—Å—á–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (—Ñ–æ—Ç–æ/—Å–µ–∫)
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏ –∏—Ö –ø—Ä–∏—á–∏–Ω

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–¢–∞–π–º–∞—É—Ç—ã –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ `app/main.py`:**
```python
extended_timeout_endpoints = {
    "/api/v1/faces/search-session": 600,  # 10 –º–∏–Ω—É—Ç
    "/api/v1/faces/index-session": 900,   # 15 –º–∏–Ω—É—Ç
}
```

**–õ–∏–º–∏—Ç—ã –≤ `PhotoIndexingService`:**
```python
max_photos_for_realtime = 300  # –ú–∞–∫—Å–∏–º—É–º –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç:**
- –ü–æ–Ω—è—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

‚úÖ **–°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:**
- –°—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –±–æ–ª—å—à–∏–º–∏ —Å–µ—Å—Å–∏—è–º–∏
- Graceful handling —Ç–∞–π–º–∞—É—Ç–æ–≤
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ó–∞—â–∏—Ç—É –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ –¥–∞–∂–µ —Å –±–æ–ª—å—à–∏–º–∏ —Å–µ—Å—Å–∏—è–º–∏!** üöÄ
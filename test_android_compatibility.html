<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Camera Compatibility Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            width: 100%;
        }
        button:hover {
            background: #0056b3;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        #log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        video {
            width: 100%;
            max-width: 400px;
            border-radius: 10px;
            background: #000;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>üîç Android Camera Compatibility Test</h1>
    
    <div class="test-section">
        <h2>üì± Device Information</h2>
        <div id="device-info"></div>
    </div>

    <div class="test-section">
        <h2>üì∑ Camera Tests</h2>
        <button onclick="testWebRTCCamera()">Test WebRTC Camera</button>
        <button onclick="testFileInputCamera()">Test File Input (capture="user")</button>
        <button onclick="testFileInputEnvironment()">Test File Input (capture="environment")</button>
        
        <video id="camera-video" class="hidden" autoplay muted></video>
        
        <!-- Test inputs -->
        <input type="file" id="test-input-user" accept="image/*" capture="user" class="hidden">
        <input type="file" id="test-input-env" accept="image/*" capture="environment" class="hidden">
        <input type="file" id="test-input-normal" accept="image/*" class="hidden">
    </div>

    <div class="test-section">
        <h2>üìã Test Log</h2>
        <div id="log"></div>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script>
        let stream = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function detectDevice() {
            const ua = navigator.userAgent;
            const info = document.getElementById('device-info');
            
            const isAndroid = /Android/.test(ua);
            const isChrome = /Chrome/.test(ua);
            const isFirefox = /Firefox/.test(ua);
            const isSamsung = /SamsungBrowser/.test(ua);
            
            let deviceType = 'Unknown';
            if (isAndroid) {
                if (isChrome) deviceType = 'Android Chrome';
                else if (isFirefox) deviceType = 'Android Firefox';
                else if (isSamsung) deviceType = 'Samsung Internet';
                else deviceType = 'Android Other';
            } else if (/iPhone|iPad/.test(ua)) {
                deviceType = 'iOS';
            } else {
                deviceType = 'Desktop';
            }

            info.innerHTML = `
                <p><strong>Device Type:</strong> ${deviceType}</p>
                <p><strong>User Agent:</strong> ${ua}</p>
                <p><strong>Screen:</strong> ${screen.width}x${screen.height}</p>
                <p><strong>Viewport:</strong> ${window.innerWidth}x${window.innerHeight}</p>
                <p><strong>MediaDevices Support:</strong> ${navigator.mediaDevices ? '‚úÖ Yes' : '‚ùå No'}</p>
                <p><strong>getUserMedia Support:</strong> ${navigator.mediaDevices && navigator.mediaDevices.getUserMedia ? '‚úÖ Yes' : '‚ùå No'}</p>
            `;

            log(`Device detected: ${deviceType}`, 'info');
        }

        async function testWebRTCCamera() {
            log('Testing WebRTC camera access...', 'info');
            
            try {
                const constraints = {
                    video: {
                        width: { ideal: 640, max: 1280 },
                        height: { ideal: 480, max: 720 },
                        facingMode: "user",
                        aspectRatio: { ideal: 1.33 }
                    },
                    audio: false
                };

                log('Requesting camera with constraints: ' + JSON.stringify(constraints), 'info');
                
                stream = await navigator.mediaDevices.getUserMedia(constraints);
                
                const video = document.getElementById('camera-video');
                video.srcObject = stream;
                video.classList.remove('hidden');
                
                log('‚úÖ WebRTC camera access successful!', 'success');
                log(`Stream tracks: ${stream.getVideoTracks().length} video, ${stream.getAudioTracks().length} audio`, 'info');
                
                // Get actual constraints
                const track = stream.getVideoTracks()[0];
                const settings = track.getSettings();
                log(`Actual settings: ${JSON.stringify(settings)}`, 'info');
                
                setTimeout(() => {
                    stopCamera();
                }, 5000);
                
            } catch (error) {
                log(`‚ùå WebRTC camera error: ${error.name} - ${error.message}`, 'error');
                
                // Detailed error analysis
                if (error.name === 'NotAllowedError') {
                    log('User denied camera permission', 'error');
                } else if (error.name === 'NotFoundError') {
                    log('No camera device found', 'error');
                } else if (error.name === 'NotSupportedError') {
                    log('Camera not supported by browser', 'error');
                } else if (error.name === 'NotReadableError') {
                    log('Camera is being used by another application', 'error');
                }
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
                document.getElementById('camera-video').classList.add('hidden');
                log('Camera stopped', 'info');
            }
        }

        function testFileInputCamera() {
            log('Testing file input with capture="user"...', 'info');
            const input = document.getElementById('test-input-user');
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    log(`‚úÖ File selected via capture="user": ${file.name} (${file.size} bytes)`, 'success');
                    log(`File type: ${file.type}`, 'info');
                } else {
                    log('‚ùå No file selected', 'error');
                }
                e.target.value = '';
            };
            
            input.click();
        }

        function testFileInputEnvironment() {
            log('Testing file input with capture="environment"...', 'info');
            const input = document.getElementById('test-input-env');
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    log(`‚úÖ File selected via capture="environment": ${file.name} (${file.size} bytes)`, 'success');
                    log(`File type: ${file.type}`, 'info');
                } else {
                    log('‚ùå No file selected', 'error');
                }
                e.target.value = '';
            };
            
            input.click();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            detectDevice();
            log('Android Camera Compatibility Test initialized', 'success');
        });

        // Test permissions API if available
        if ('permissions' in navigator) {
            navigator.permissions.query({name: 'camera'}).then(function(result) {
                log(`Camera permission status: ${result.state}`, 'info');
            }).catch(function(error) {
                log(`Permission query error: ${error.message}`, 'error');
            });
        }
    </script>
</body>
</html>
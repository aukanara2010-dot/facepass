# ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö Pixora - –ó–∞–≤–µ—Ä—à–µ–Ω–æ

## üéØ –û–±–∑–æ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–µ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö Pixora –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏–π –∏ —Å—Ç–∞—Ç—É—Å–∞ FacePass.

## üìã –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `MAIN_APP_DATABASE_URL` –≤ `.env`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `core/config.py`
- ‚úÖ –°–æ–∑–¥–∞–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ Pixora –≤ `core/database.py`

### 2. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `PhotoSession` –≤ `models/photo_session.py`
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ UUID (—Ä–µ–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã)
- ‚úÖ –í—Å–µ –ø–æ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `photo_sessions`

### 3. API —Å—Ö–µ–º—ã
- ‚úÖ Pydantic —Å—Ö–µ–º—ã –≤ `app/schemas/photo_session.py`
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è UUID –∏ datetime –ø–æ–ª–µ–π
- ‚úÖ –°—Ö–µ–º—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

### 4. API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- ‚úÖ `/api/v1/sessions/validate/{session_id}` - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏
- ‚úÖ `/api/v1/sessions/{session_id}` - –¥–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏
- ‚úÖ `/api/v1/sessions/{session_id}/facepass-status` - —Å—Ç–∞—Ç—É—Å FacePass
- ‚úÖ `/api/v1/sessions/{session_id}/interface` - HTML –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### 5. HTML –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å FacePass –≤ `app/static/session/index.html`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞–º–µ—Ä–æ–π –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ª–∏—Ü

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Pixora

```sql
Table: photo_sessions
- id: UUID (Primary Key)
- name: TEXT (NOT NULL)
- description: TEXT (NULL)
- photographer_id: UUID (NOT NULL)
- studio_id: UUID (NOT NULL)
- status: USER-DEFINED (NOT NULL)
- scheduled_at: TIMESTAMP WITH TIME ZONE (NULL)
- completed_at: TIMESTAMP WITH TIME ZONE (NULL)
- settings: JSONB (NULL)
- created_at: TIMESTAMP WITH TIME ZONE (NOT NULL)
- updated_at: TIMESTAMP WITH TIME ZONE (NOT NULL)
- service_package_id: UUID (NULL)
- facepass_enabled: BOOLEAN (NOT NULL)
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```env
MAIN_APP_DATABASE_URL=postgresql://postgres:Gqmkcp2HUcgbeWlScZN1GUvkpxdqsTFX@155.212.216.176:5432/postgres
```

**–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:** ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
```
‚úÖ Basic connection test: 1
‚úÖ photo_sessions table exists
üìä Total sessions: 1
üéØ Sessions with FacePass enabled: 1
```

### –¢–µ—Å—Ç –º–æ–¥–µ–ª–∏ PhotoSession
```
‚úÖ Found 1 sessions in database
‚úÖ Successfully found session by ID
üéØ Sessions with FacePass enabled: 1
```

### –¢–µ—Å—Ç API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
```
‚úÖ Session validation: 200 OK
‚úÖ Session details: 200 OK  
‚úÖ FacePass status: 200 OK
‚úÖ Interface page: 200 OK
‚úÖ Non-existent session handling: 200 OK (valid: false)
```

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ API

```bash
curl -X GET "http://localhost:8000/api/v1/sessions/validate/1788875f-fc71-49d6-a9fa-a060e3ee6fee"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "valid": true,
  "session": {
    "id": "1788875f-fc71-49d6-a9fa-a060e3ee6fee",
    "name": "–¢–µ—Å—Ç–æ–≤–∞—è –ø–æ–∏—Å–∫ –ø–æ –ª–∏—Ü—É",
    "studio_id": "9cccbfe6-2137-4d5a-97c7-e470dd73a758",
    "facepass_enabled": true,
    "photographer_id": "5ff5d5fd-1068-405f-b4c9-3c9c01a499d9",
    "status": "created",
    "created_at": "2026-02-18T17:55:51.746000+00:00",
    "updated_at": "2026-02-18T17:55:51.746000+00:00"
  },
  "error": null
}
```

### 2. –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É FacePass

```
GET http://localhost:8000/api/v1/sessions/1788875f-fc71-49d6-a9fa-a060e3ee6fee/interface
```

### 3. –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from core.database import get_pixora_db
from models.photo_session import PhotoSession

def validate_session(session_id: str):
    db = next(get_pixora_db())
    session = db.query(PhotoSession).filter_by(id=session_id).first()
    return session and session.is_facepass_active()
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- ‚úÖ **–¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ**: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Pixora –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è SELECT
- ‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è**: –í—Å–µ –∑–∞–ø–∏—Å–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Å—Å–∏–∏
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö IP
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SSL/TLS –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:
- ‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω: `ping 155.212.216.176`
- ‚úÖ –ü–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç: `telnet 155.212.216.176 5432`
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã

### –ú–µ—Ç—Ä–∏–∫–∏:
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: ~100ms
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π: 100%
- –°–µ—Å—Å–∏–π —Å FacePass: 1/1 (100%)

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
python3 test_db_connection.py

# –¢–µ—Å—Ç –º–æ–¥–µ–ª–∏ PhotoSession
python3 test_session_model.py

# –¢–µ—Å—Ç API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
python3 test_session_endpoints_simple.py
```

## üìù –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ê–ª–≥–æ—Ä–∏—Ç–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–∏:

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞** —Å UUID —Å–µ—Å—Å–∏–∏
2. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ Pixora** (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
3. **–ü–æ–∏—Å–∫ —Å–µ—Å—Å–∏–∏** –ø–æ UUID
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è** —Å–µ—Å—Å–∏–∏
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ FacePass** (`facepass_enabled = true`)
6. **–í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞** –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:

- **–°–µ—Å—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞** ‚Üí `valid: false, error: "Session not found"`
- **FacePass –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω** ‚Üí `valid: false, error: "FacePass is not enabled"`
- **–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è** ‚Üí HTTP 500 —Å –¥–µ—Ç–∞–ª—è–º–∏ –æ—à–∏–±–∫–∏

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:

1. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–æ–±–∞–≤–∏—Ç—å Redis –∫–µ—à –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–π
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
3. **–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ** - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

1. **Batch –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Å—Å–∏–π –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
2. **Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Å—Ç–∞—Ç—É—Å–∞ FacePass
3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
4. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è FacePass

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö Pixora —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞. –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:

- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `MAIN_APP_DATABASE_URL`
- ‚úÖ –°–æ–∑–¥–∞–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–Ω–µ—à–Ω–µ–π –±–∞–∑–µ (–∞–Ω–∞–ª–æ–≥ prismaMain)
- ‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã `photo_sessions`
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–π
- ‚úÖ –°–æ–∑–¥–∞–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å FacePass –¥–ª—è –≤–∞–ª–∏–¥–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- ‚úÖ –û–±–µ—Å–ø–µ—á–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–π –±–∞–∑—ã)

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.